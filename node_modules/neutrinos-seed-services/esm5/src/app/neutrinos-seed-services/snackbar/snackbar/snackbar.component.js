import { __decorate } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { NSnackbarService } from '../../n-snackbar.service';
var SnackbarComponent = /** @class */ (function () {
    function SnackbarComponent(snackbarService) {
        var _this = this;
        this.snackbarService = snackbarService;
        this.max = 1;
        this.onAdd = new EventEmitter();
        this.onRemove = new EventEmitter();
        this.onClear = new EventEmitter();
        this.snacks = [];
        this.snackbarService.get()
            .subscribe(function (snack) {
            if (snack.action === 'add') {
                _this.add(snack.data);
            }
            else if (snack.action === 'remove') {
                _this.remove(snack.id);
            }
            else if (snack.action === 'clear') {
                _this.clear();
            }
        });
    }
    SnackbarComponent.prototype.add = function (snack) {
        var _this = this;
        var timeout;
        var id = this.uuid();
        if (this.max && this.max > 0 && this.snacks.length === this.max) {
            this.remove(this.snacks[0].id);
        }
        if (snack.timeout || this.timeout) {
            timeout = setTimeout(function () {
                _this.remove(id);
            }, snack.timeout || this.timeout);
        }
        var data = Object.assign({ id: id, timeoutObj: timeout }, snack);
        if (snack.action) {
            var that_1 = this;
            var fcn_1 = snack.action.onClick || new Function();
            snack.action.onClick = function () {
                fcn_1(data);
                that_1.remove(id);
            };
        }
        if (snack.onAdd) {
            snack.onAdd(data);
        }
        if (this.onAdd) {
            this.onAdd.emit(data);
        }
        this.snacks.push(data);
    };
    SnackbarComponent.prototype.remove = function (id) {
        var snack = this.snacks.find(function (obj) { return obj.id === id; });
        if (snack) {
            if (snack.onRemove) {
                snack.onRemove(snack);
            }
            if (this.onRemove) {
                this.onRemove.emit(snack);
            }
            if (snack.timeoutObj) {
                clearTimeout(snack.timeoutObj);
            }
        }
        this.snacks = this.snacks.filter(function (obj) { return obj.id !== id; });
    };
    SnackbarComponent.prototype.clear = function () {
        // this.snacks.forEach(snack => {
        //   this.remove(snack.id);
        // });
        this.snacks = [];
        if (this.onClear) {
            this.onClear.emit(true);
        }
    };
    SnackbarComponent.prototype.uuid = function () {
        // tslint:disable:no-bitwise
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        // tslint:enable:no-bitwise
    };
    SnackbarComponent.prototype.calcTextColor = function (background) {
        if (!background) {
            return null;
        }
        function hexToRgb(hex) {
            var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                return r + r + g + g + b + b;
            });
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }
        var rgb = hexToRgb(background);
        if (!rgb) {
            return null;
        }
        var color = [rgb.r / 255, rgb.g / 255, rgb.b / 255];
        for (var i = 0; i < color.length; ++i) {
            if (color[i] <= 0.03928) {
                color[i] = color[i] / 12.92;
            }
            else {
                color[i] = Math.pow((color[i] + 0.055) / 1.055, 2.4);
            }
        }
        var l = 0.2126 * color[0] + 0.7152 * color[1] + 0.0722 * color[2];
        if (l > 0.179) {
            return '#000';
        }
        else {
            return '#fff';
        }
    };
    SnackbarComponent.ctorParameters = function () { return [
        { type: NSnackbarService }
    ]; };
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "position", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "max", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "background", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "accent", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "color", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "customClass", void 0);
    __decorate([
        Input()
    ], SnackbarComponent.prototype, "timeout", void 0);
    __decorate([
        Output()
    ], SnackbarComponent.prototype, "onAdd", void 0);
    __decorate([
        Output()
    ], SnackbarComponent.prototype, "onRemove", void 0);
    __decorate([
        Output()
    ], SnackbarComponent.prototype, "onClear", void 0);
    SnackbarComponent = __decorate([
        Component({
            selector: 'n-snackbar',
            template: "\n      <div class=\"snackbars\" [ngClass]=\"position || 'bottom-center'\">\n          <n-snack   *ngFor=\"let snackbar of snacks\" [background]=\"snackbar.background || background\"\n                        [customClass]=\"snackbar.customClass || customClass\"\n                        [color]=\"snackbar.color || color || calcTextColor(snackbar.background || background)\">\n              <div class=\"container\">\n              <div class=\"snack-text child\" >\n                  {{snackbar.msg}}\n              </div>\n              <div *ngIf=\"snackbar.action.text\" class=\"snack-action\" (click)=\"snackbar.action.onClick()\"\n                   [ngStyle]=\"{color: snackbar.action.color || accent}\">\n                  {{snackbar.action.text}}\n              </div>\n              </div>\n          </n-snack>\n      </div>\n  ",
            styles: [".snack-action{cursor:pointer;color:#2196f3;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{width:60%;flex:1 0;margin-right:.5em}.snackbars.bottom-center{align-items:middle;left:50%;transform:translate(-50%,0);bottom:1px;align-items:center}.snackbars{position:fixed;z-index:99999;max-width:100%;word-wrap:break-word;display:inline;font-family:Roboto;letter-spacing:1px}.snack{padding:1em;border-radius:.3em;max-height:50vh;overflow:auto}"]
        })
    ], SnackbarComponent);
    return SnackbarComponent;
}());
export { SnackbarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25hY2tiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLXNlZWQtc2VydmljZXMvIiwic291cmNlcyI6WyJzcmMvYXBwL25ldXRyaW5vcy1zZWVkLXNlcnZpY2VzL3NuYWNrYmFyL3NuYWNrYmFyL3NuYWNrYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQXVCNUQ7SUFtQkUsMkJBQW9CLGVBQWlDO1FBQXJELGlCQVdDO1FBWG1CLG9CQUFlLEdBQWYsZUFBZSxDQUFrQjtRQWpCNUMsUUFBRyxHQUFXLENBQUMsQ0FBQztRQU9SLFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNuRCxhQUFRLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdEQsWUFBTyxHQUEwQixJQUFJLFlBQVksRUFBVyxDQUFDO1FBRTlFLFdBQU0sR0FJRCxFQUFFLENBQUM7UUFHTixJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRTthQUN2QixTQUFTLENBQUMsVUFBQSxLQUFLO1lBQ2QsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLEtBQUssRUFBRTtnQkFDMUIsS0FBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDdEI7aUJBQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLFFBQVEsRUFBRTtnQkFDcEMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDdkI7aUJBQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLE9BQU8sRUFBRTtnQkFDbkMsS0FBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ2Q7UUFDSCxDQUFDLENBQUMsQ0FBQztJ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O1FBQVIsS0FBSyxFQUFFO2tEQUFpQjtJQUNoQjtRQUFSLEtBQUssRUFBRTt5REFBb0I7SUFDbkI7UUFBUixLQUFLLEVBQUU7cURBQWdCO0lBQ2Y7UUFBUixLQUFLLEVBQUU7b0RBQWU7SUFDZDtRQUFSLEtBQUssRUFBRTswREFBa0I7SUFDakI7UUFBUixLQUFLLEVBQUU7c0RBQWlCO0lBRWY7UUFBVCxNQUFNLEVBQUU7b0RBQTJEO0lBQzFEO1FBQVQsTUFBTSxFQUFFO3VEQUE4RDtJQUM3RDtRQUFULE1BQU0sRUFBRTtzREFBcUU7SUFYbkUsaUJBQWlCO1FBckI3QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsWUFBWTtZQUN0QixRQUFRLEVBQUUseTBCQWdCVDs7U0FFRixDQUFDO09BQ1csaUJBQWlCLENBdUo3QjtJQUFELHdCQUFDO0NBQUEsQUF2SkQsSUF1SkM7U0F2SlksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTlNuYWNrYmFyU2VydmljZSB9IGZyb20gJy4uLy4uL24tc25hY2tiYXIuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ24tc25hY2tiYXInLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJzbmFja2JhcnNcIiBbbmdDbGFzc109XCJwb3NpdGlvbiB8fCAnYm90dG9tLWNlbnRlcidcIj5cclxuICAgICAgICAgIDxuLXNuYWNrICAgKm5nRm9yPVwibGV0IHNuYWNrYmFyIG9mIHNuYWNrc1wiIFtiYWNrZ3JvdW5kXT1cInNuYWNrYmFyLmJhY2tncm91bmQgfHwgYmFja2dyb3VuZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtjdXN0b21DbGFzc109XCJzbmFja2Jhci5jdXN0b21DbGFzcyB8fCBjdXN0b21DbGFzc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtjb2xvcl09XCJzbmFja2Jhci5jb2xvciB8fCBjb2xvciB8fCBjYWxjVGV4dENvbG9yKHNuYWNrYmFyLmJhY2tncm91bmQgfHwgYmFja2dyb3VuZClcIj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNuYWNrLXRleHQgY2hpbGRcIiA+XHJcbiAgICAgICAgICAgICAgICAgIHt7c25hY2tiYXIubXNnfX1cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwic25hY2tiYXIuYWN0aW9uLnRleHRcIiBjbGFzcz1cInNuYWNrLWFjdGlvblwiIChjbGljayk9XCJzbmFja2Jhci5hY3Rpb24ub25DbGljaygpXCJcclxuICAgICAgICAgICAgICAgICAgIFtuZ1N0eWxlXT1cIntjb2xvcjogc25hY2tiYXIuYWN0aW9uLmNvbG9yIHx8IGFjY2VudH1cIj5cclxuICAgICAgICAgICAgICAgICAge3tzbmFja2Jhci5hY3Rpb24udGV4dH19XHJcbiAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICA8L24tc25hY2s+XHJcbiAgICAgIDwvZGl2PlxyXG4gIGAsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc25hY2tiYXIuc3R5bGUuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFNuYWNrYmFyQ29tcG9uZW50IHtcclxuICBASW5wdXQoKSBwb3NpdGlvbjogJ3RvcC1sZWZ0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtcmlnaHQnIHwgJ2JvdHRvbS1sZWZ0JyB8ICdib3R0b20tY2VudGVyJyB8ICdib3R0b20tcmlnaHQnO1xyXG4gIEBJbnB1dCgpIG1heDogbnVtYmVyID0gMTtcclxuICBASW5wdXQoKSBiYWNrZ3JvdW5kOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgYWNjZW50OiBzdHJpbmc7XHJcbiAgQElucHV0KCkgY29sb3I6IHN0cmluZztcclxuICBASW5wdXQoKSBjdXN0b21DbGFzczogYW55O1xyXG4gIEBJbnB1dCgpIHRpbWVvdXQ6IG51bWJlcjtcclxuXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBvbkFkZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgcHVibGljIG9uUmVtb3ZlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25DbGVhcjogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICBzbmFja3M6IEFycmF5PHtcclxuICAgIGlkOiBzdHJpbmcsIG1zZzogc3RyaW5nLCB0aW1lb3V0PzogbnVtYmVyLCBjb2xvcj86IHN0cmluZywgYmFja2dyb3VuZD86IHN0cmluZywgY3VzdG9tQ2xhc3M/OiBhbnksIGFjdGlvbj86IHtcclxuICAgICAgdGV4dDogc3RyaW5nLCBvbkNsaWNrPzogRnVuY3Rpb24sIGNvbG9yPzogc3RyaW5nXHJcbiAgICB9LCBvbkFkZD86IEZ1bmN0aW9uLCBvblJlbW92ZT86IEZ1bmN0aW9uLCB0aW1lb3V0T2JqPzogYW55XHJcbiAgfT4gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzbmFja2JhclNlcnZpY2U6IE5TbmFja2JhclNlcnZpY2UpIHtcclxuICAgIHRoaXMuc25hY2tiYXJTZXJ2aWNlLmdldCgpXHJcbiAgICAgIC5zdWJzY3JpYmUoc25hY2sgPT4ge1xyXG4gICAgICAgIGlmIChzbmFjay5hY3Rpb24gPT09ICdhZGQnKSB7XHJcbiAgICAgICAgICB0aGlzLmFkZChzbmFjay5kYXRhKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHNuYWNrLmFjdGlvbiA9PT0gJ3JlbW92ZScpIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlKHNuYWNrLmlkKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHNuYWNrLmFjdGlvbiA9PT0gJ2NsZWFyJykge1xyXG4gICAgICAgICAgdGhpcy5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGQoc25hY2spIHtcclxuICAgIGxldCB0aW1lb3V0O1xyXG4gICAgY29uc3QgaWQgPSB0aGlzLnV1aWQoKTtcclxuXHJcbiAgICBpZiAodGhpcy5tYXggJiYgdGhpcy5tYXggPiAwICYmIHRoaXMuc25hY2tzLmxlbmd0aCA9PT0gdGhpcy5tYXgpIHtcclxuICAgICAgdGhpcy5yZW1vdmUodGhpcy5zbmFja3NbMF0uaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzbmFjay50aW1lb3V0IHx8IHRoaXMudGltZW91dCkge1xyXG4gICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmUoaWQpO1xyXG4gICAgICB9LCBzbmFjay50aW1lb3V0IHx8IHRoaXMudGltZW91dClcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkYXRhID0gT2JqZWN0LmFzc2lnbih7IGlkOiBpZCwgdGltZW91dE9iajogdGltZW91dCB9LCBzbmFjayk7XHJcblxyXG4gICAgaWYgKHNuYWNrLmFjdGlvbikge1xyXG4gICAgICBjb25zdCB0aGF0ID0gdGhpcztcclxuICAgICAgY29uc3QgZmNuID0gc25hY2suYWN0aW9uLm9uQ2xpY2sgfHwgbmV3IEZ1bmN0aW9uKCk7XHJcbiAgICAgIHNuYWNrLmFjdGlvbi5vbkNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgIGZjbihkYXRhKTtcclxuICAgICAgICB0aGF0LnJlbW92ZShpZCk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNuYWNrLm9uQWRkKSB7XHJcbiAgICAgIHNuYWNrLm9uQWRkKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLm9uQWRkKSB7XHJcbiAgICAgIHRoaXMub25BZGQuZW1pdChkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNuYWNrcy5wdXNoKGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKGlkKSB7XHJcbiAgICBjb25zdCBzbmFjayA9IHRoaXMuc25hY2tzLmZpbmQob2JqID0+IG9iai5pZCA9PT0gaWQpO1xyXG5cclxuICAgIGlmIChzbmFjaykge1xyXG4gICAgICBpZiAoc25hY2sub25SZW1vdmUpIHtcclxuICAgICAgICBzbmFjay5vblJlbW92ZShzbmFjayk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLm9uUmVtb3ZlKSB7XHJcbiAgICAgICAgdGhpcy5vblJlbW92ZS5lbWl0KHNuYWNrKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHNuYWNrLnRpbWVvdXRPYmopIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQoc25hY2sudGltZW91dE9iaik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNuYWNrcyA9IHRoaXMuc25hY2tzLmZpbHRlcihvYmogPT4gb2JqLmlkICE9PSBpZCk7XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIC8vIHRoaXMuc25hY2tzLmZvckVhY2goc25hY2sgPT4ge1xyXG4gICAgLy8gICB0aGlzLnJlbW92ZShzbmFjay5pZCk7XHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICB0aGlzLnNuYWNrcyA9IFtdO1xyXG5cclxuICAgIGlmICh0aGlzLm9uQ2xlYXIpIHtcclxuICAgICAgdGhpcy5vbkNsZWFyLmVtaXQodHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1dWlkKCkge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGU6bm8tYml0d2lzZVxyXG4gICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcclxuICAgICAgY29uc3QgciA9IE1hdGgucmFuZG9tKCkgKiAxNiB8IDAsIHYgPSBjID09PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xyXG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XHJcbiAgICB9KTtcclxuICAgIC8vIHRzbGludDplbmFibGU6bm8tYml0d2lzZVxyXG4gIH1cclxuXHJcbiAgY2FsY1RleHRDb2xvcihiYWNrZ3JvdW5kKSB7XHJcbiAgICBpZiAoIWJhY2tncm91bmQpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7XHJcbiAgICAgIGNvbnN0IHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcclxuICAgICAgaGV4ID0gaGV4LnJlcGxhY2Uoc2hvcnRoYW5kUmVnZXgsIChtLCByLCBnLCBiKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSAvXiM/KFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pJC9pLmV4ZWMoaGV4KTtcclxuICAgICAgcmV0dXJuIHJlc3VsdCA/IHtcclxuICAgICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcclxuICAgICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcclxuICAgICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxyXG4gICAgICB9IDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZ2IgPSBoZXhUb1JnYihiYWNrZ3JvdW5kKTtcclxuICAgIGlmICghcmdiKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbG9yID0gW3JnYi5yIC8gMjU1LCByZ2IuZyAvIDI1NSwgcmdiLmIgLyAyNTVdO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3IubGVuZ3RoOyArK2kpIHtcclxuICAgICAgaWYgKGNvbG9yW2ldIDw9IDAuMDM5MjgpIHtcclxuICAgICAgICBjb2xvcltpXSA9IGNvbG9yW2ldIC8gMTIuOTI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29sb3JbaV0gPSBNYXRoLnBvdygoY29sb3JbaV0gKyAwLjA1NSkgLyAxLjA1NSwgMi40KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGwgPSAwLjIxMjYgKiBjb2xvclswXSArIDAuNzE1MiAqIGNvbG9yWzFdICsgMC4wNzIyICogY29sb3JbMl07XHJcblxyXG4gICAgaWYgKGwgPiAwLjE3OSkge1xyXG4gICAgICByZXR1cm4gJyMwMDAnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcjZmZmJztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19