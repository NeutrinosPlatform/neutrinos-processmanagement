/**
 * @fileoverview added by tsickle
 * Generated from: lib/neutrinos-oauth-client.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __awaiter, __generator } from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Subject } from 'rxjs';
import { UtilService } from './services/util.service';
import * as i0 from "@angular/core";
import * as i1 from "./services/util.service";
import * as i2 from "@angular/common/http";
var NeutrinosOAuthClientService = /** @class */ (function () {
    function NeutrinosOAuthClientService(util, http) {
        this.util = util;
        this.http = http;
        this.cookieName = 'connect.sid';
        this.authStateSubject = new Subject();
    }
    Object.defineProperty(NeutrinosOAuthClientService.prototype, "userInfo", {
        /**
         * Get user info and tokens of the current logged in user
         */
        get: /**
         * Get user info and tokens of the current logged in user
         * @return {?}
         */
        function () {
            return this.currentUserInfo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NeutrinosOAuthClientService.prototype, "isLoggedIn", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currentUserInfo ? true : false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} userInfo
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.setUserInfo = /**
     * @private
     * @param {?} userInfo
     * @return {?}
     */
    function (userInfo) {
        this.currentUserInfo = userInfo;
    };
    /**
     * Performs authentication based on configuration and returns user info for mobile env and
     * for web app user info is stored in memory. Call userInfo getter method to retrieve userinfo
     * @param redirectBackUrl - url to redirect back to when authentication is done. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     */
    /**
     * Performs authentication based on configuration and returns user info for mobile env and
     * for web app user info is stored in memory. Call userInfo getter method to retrieve userinfo
     * @param {?=} redirectBackUrl - url to redirect back to when authentication is done. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.login = /**
     * Performs authentication based on configuration and returns user info for mobile env and
     * for web app user info is stored in memory. Call userInfo getter method to retrieve userinfo
     * @param {?=} redirectBackUrl - url to redirect back to when authentication is done. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    function (redirectBackUrl) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (_this.util.getEnvValue('isIDSEnabled') === 'false') {
                return reject({ message: 'IDS is not enabled in environments' });
            }
            if (_this.util.getPlatformType() === 'browser') {
                _this.loginWithRedirect(redirectBackUrl);
                return;
            }
            _this.loginWithInAppBrowser()
                .then((/**
             * @param {?} tokenset
             * @return {?}
             */
            function (tokenset) {
                return resolve(tokenset);
            }))
                .catch((/**
             * @param {?} authError
             * @return {?}
             */
            function (authError) {
                return reject(authError);
            }));
        }));
    };
    /**
     *
     * @param loginUrl - Login url where SSD is hosted
     */
    /**
     *
     * @private
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.loginWithInAppBrowser = /**
     *
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {
            var scriptURLS, script, inAppBrowserRef, executeScriptCB, exitCB;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        scriptURLS = ['/interaction/', '/auth-provider/return'];
                        // execute JS only for this urls
                        return [4 /*yield*/, this.getScript()];
                    case 1:
                        script = _a.sent();
                        // Get JS which stores guid and device details in local storage of webview
                        inAppBrowserRef = cordova.InAppBrowser.open(this.util.getMobileLoginUrl(), '_blank');
                        executeScriptCB = (/**
                         * @param {?} event
                         * @return {?}
                         */
                        function (event) {
                            if (event && event.hasOwnProperty('type') && event.hasOwnProperty('url') && event.type === 'loadstop'
                                && _this.isURLMatch(event.url, scriptURLS)) {
                                inAppBrowserRef.executeScript({ code: script }, (/**
                                 * @return {?}
                                 */
                                function () { }));
                            }
                        });
                        inAppBrowserRef.addEventListener('loadstop', executeScriptCB);
                        exitCB = (/**
                         * @return {?}
                         */
                        function () {
                            return reject({ code: 'auth-cancel', message: 'Authentication cancelled by user' });
                        });
                        inAppBrowserRef.addEventListener('message', (/**
                         * @param {?} message
                         * @return {?}
                         */
                        function (message) {
                            if (message && message.data && message.data.auth && message.data.auth === 'success') {
                                inAppBrowserRef.removeEventListener('exit', exitCB);
                                inAppBrowserRef.close();
                                _this.persistCookies();
                                _this.getUserInfo().then((/**
                                 * @param {?} tokenset
                                 * @return {?}
                                 */
                                function (tokenset) {
                                    return resolve(tokenset);
                                })).catch((/**
                                 * @param {?} authErr
                                 * @return {?}
                                 */
                                function (authErr) {
                                    return reject(authErr);
                                }));
                            }
                        }));
                        // settle the promise if user closed the in app browser manually
                        inAppBrowserRef.addEventListener('exit', exitCB);
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    /**
     * @private
     * @param {?} url
     * @param {?} compareWith
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.isURLMatch = /**
     * @private
     * @param {?} url
     * @param {?} compareWith
     * @return {?}
     */
    function (url, compareWith) {
        return compareWith.some((/**
         * @param {?} u
         * @return {?}
         */
        function (u) { return url.includes(u); }));
    };
    /**
     * Returns JS as a string to be executed in inAppBrowser which sets guid and device details in localStorage
     */
    /**
     * Returns JS as a string to be executed in inAppBrowser which sets guid and device details in localStorage
     * @private
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.getScript = /**
     * Returns JS as a string to be executed in inAppBrowser which sets guid and device details in localStorage
     * @private
     * @return {?}
     */
    function () {
        return __awaiter(this, void 0, void 0, function () {
            var deviceDetails, guid, guidScript, script;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        deviceDetails = JSON.stringify(window['device']) || {};
                        return [4 /*yield*/, this.getuniqueDeviceID()];
                    case 1:
                        guid = _a.sent();
                        guidScript = guid ? "localStorage.setItem('guid', '" + guid + "')" : '';
                        script = guidScript + "\n          localStorage.setItem('additionalInfo', '" + deviceDetails + "')\n          window.isScriptExecuted = true;";
                        return [2 /*return*/, script];
                }
            });
        });
    };
    /**
     * @private
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.getuniqueDeviceID = /**
     * @private
     * @return {?}
     */
    function () {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            window['plugins'].uniqueDeviceID.get((/**
             * @param {?} guid
             * @return {?}
             */
            function (guid) {
                return resolve(guid);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                return resolve(null);
            }));
        }));
    };
    /**
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.getUserInfo = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            /** @type {?} */
            var headers = new HttpHeaders();
            /*Edge case: Userinfo is retreived from cache when login page is opened and user cancels the login attempt  */
            headers = headers.set('Cache-Control', 'no-cache');
            headers = headers.set('Pragma', 'no-cache');
            _this.http.get(_this.util.getUserInfoUrl(), { headers: headers }).subscribe((/**
             * @param {?} tokenset
             * @return {?}
             */
            function (tokenset) {
                _this.setUserInfo(tokenset);
                return resolve(tokenset);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                _this.destroyClientSession();
                return reject(error);
            }));
        }));
    };
    /*If SSD throws 401 during any http request due to refresh token expiry, cookie expiry or access revoke nullify the userinfo in memory
    and emit authState event  */
    /*If SSD throws 401 during any http request due to refresh token expiry, cookie expiry or access revoke nullify the userinfo in memory
      and emit authState event  */
    /**
     * @param {?} errorResponse
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.removeUserInfo = /*If SSD throws 401 during any http request due to refresh token expiry, cookie expiry or access revoke nullify the userinfo in memory
      and emit authState event  */
    /**
     * @param {?} errorResponse
     * @return {?}
     */
    function (errorResponse) {
        this.destroyClientSession();
        this.authStateSubject.next(errorResponse);
    };
    /**
     * Returns event when Auth state has changed due to session expiry, access revoke or cookie expiry.
     */
    /**
     * Returns event when Auth state has changed due to session expiry, access revoke or cookie expiry.
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.authState = /**
     * Returns event when Auth state has changed due to session expiry, access revoke or cookie expiry.
     * @return {?}
     */
    function () {
        return this.authStateSubject.asObservable();
    };
    /**
     * @private
     * @param {?} redirectBackUrl
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.loginWithRedirect = /**
     * @private
     * @param {?} redirectBackUrl
     * @return {?}
     */
    function (redirectBackUrl) {
        window.location.href = this.util.getWebLoginUrl(redirectBackUrl);
    };
    /**
     * Persists cookies in localStorage to be used during next app launch only for IOS
     */
    /**
     * Persists cookies in localStorage to be used during next app launch only for IOS
     * @private
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.persistCookies = /**
     * Persists cookies in localStorage to be used during next app launch only for IOS
     * @private
     * @return {?}
     */
    function () {
        if (window['device'] && window['device'].platform === 'iOS') {
            this.getCookie(this.cookieName, this.util.getSSDBasePath())
                .then((/**
             * @param {?} connectSid
             * @return {?}
             */
            function (connectSid) {
                localStorage.setItem('connectSid', connectSid);
            }));
        }
    };
    /**
     * Restores the connect.sid cookie from session storage during app bootstrap if device is mobile
     */
    /**
     * Restores the connect.sid cookie from session storage during app bootstrap if device is mobile
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.restoreCookies = /**
     * Restores the connect.sid cookie from session storage during app bootstrap if device is mobile
     * @return {?}
     */
    function () {
        return __awaiter(this, void 0, void 0, function () {
            var connectSidCookie;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        connectSidCookie = localStorage.getItem('connectSid');
                        if (!connectSidCookie) {
                            return [2 /*return*/, false];
                        }
                        return [4 /*yield*/, this.setCookie(this.util.getSSDBasePath(), this.cookieName, connectSidCookie)];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    /**
     *
     * @param url - site where the cookie is stored
     * @param cookieName - name of the cookie to restore
     * @param cookieValue - value of the cookie to restore
     */
    /**
     *
     * @private
     * @param {?} url - site where the cookie is stored
     * @param {?} cookieName - name of the cookie to restore
     * @param {?} cookieValue - value of the cookie to restore
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.setCookie = /**
     *
     * @private
     * @param {?} url - site where the cookie is stored
     * @param {?} cookieName - name of the cookie to restore
     * @param {?} cookieValue - value of the cookie to restore
     * @return {?}
     */
    function (url, cookieName, cookieValue) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            cookieMaster.setCookieValue(url, cookieName, cookieValue, (/**
             * @return {?}
             */
            function () {
                return resolve(true);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                return reject(error);
            }));
        }));
    };
    /**
     *
     * @param  cookieName - name of the cookie to retrieve
     * @param   url - site where the cookie is stored
     */
    /**
     *
     * @private
     * @param {?} cookieName - name of the cookie to retrieve
     * @param {?} url - site where the cookie is stored
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.getCookie = /**
     *
     * @private
     * @param {?} cookieName - name of the cookie to retrieve
     * @param {?} url - site where the cookie is stored
     * @return {?}
     */
    function (cookieName, url) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            cookieMaster.getCookieValue(url, cookieName, (/**
             * @param {?} cookie
             * @return {?}
             */
            function (cookie) {
                return resolve(cookie.cookieValue);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                return reject(error);
            }));
        }));
    };
    /**
     * Logout the current user, destroys session between client and server.
     * @param redirectBackUrl - URL where the user is navigated post logout. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     */
    /**
     * Logout the current user, destroys session between client and server.
     * @param {?=} redirectBackUrl - URL where the user is navigated post logout. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.logout = /**
     * Logout the current user, destroys session between client and server.
     * @param {?=} redirectBackUrl - URL where the user is navigated post logout. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    function (redirectBackUrl) {
        var _this = this;
        /** @type {?} */
        var logoutUrl = (this.util.getPlatformType() === 'browser') ? this.util.getWebLogoutUrl(redirectBackUrl)
            : this.util.getMobileLogoutUrl();
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.http.get(logoutUrl).subscribe((/**
             * @param {?} idsLogoutInfo
             * @return {?}
             */
            function (idsLogoutInfo) {
                _this.destroyIDSSession(idsLogoutInfo)
                    .then((/**
                 * @return {?}
                 */
                function () {
                    return resolve();
                }))
                    .catch((/**
                 * @param {?} logoutErr
                 * @return {?}
                 */
                function (logoutErr) {
                    return reject(logoutErr);
                }));
            }), (/**
             * @param {?} logoutError
             * @return {?}
             */
            function (logoutError) {
                return reject(logoutError);
            }));
        }));
    };
    /**
     * @private
     * @param {?} idsInfo
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.destroyIDSSession = /**
     * @private
     * @param {?} idsInfo
     * @return {?}
     */
    function (idsInfo) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            if (idsInfo['sessionExists'] === false) {
                // No session present with SSD due to cookie expiry
                _this.destroyClientSession();
                _this.authStateSubject.next({ code: 'NO_SESSION', message: 'User session has already expired' });
                return resolve();
            }
            if (_this.util.getPlatformType() === 'browser') {
                window.location.href = idsInfo['idsURL'];
            }
            else {
                _this.logoutWithInappBrowser(idsInfo['idsURL'])
                    .then((/**
                 * @return {?}
                 */
                function () {
                    return resolve();
                }))
                    .catch((/**
                 * @param {?} sessionError
                 * @return {?}
                 */
                function (sessionError) {
                    return reject(sessionError);
                }));
            }
        }));
    };
    /**
     *
     * @param idsLogoutUrl - IDS logout url
     * Opens InApp browser and destroys the session
     */
    /**
     *
     * @private
     * @param {?} idsLogoutUrl - IDS logout url
     * Opens InApp browser and destroys the session
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.logoutWithInappBrowser = /**
     *
     * @private
     * @param {?} idsLogoutUrl - IDS logout url
     * Opens InApp browser and destroys the session
     * @return {?}
     */
    function (idsLogoutUrl) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            /** @type {?} */
            var exitCB = (/**
             * @return {?}
             */
            function () {
                return reject({ code: 'auth-cancel', message: 'Authentication cancelled by user' });
            });
            /** @type {?} */
            var inAppBrowserRef = cordova.InAppBrowser.open(idsLogoutUrl, '_blank');
            inAppBrowserRef.addEventListener('message', (/**
             * @param {?} message
             * @return {?}
             */
            function (message) {
                // Remove exit listener if script closed the in app browser
                if (message && message.data && message.data.auth && message.data.auth === 'success') {
                    inAppBrowserRef.removeEventListener('exit', exitCB);
                    inAppBrowserRef.close();
                    _this.destroyClientSession();
                    return resolve();
                }
            }));
            // settle the promise if user closed the in app browser manually
            inAppBrowserRef.addEventListener('exit', exitCB);
        }));
    };
    /*Remove persisted cookies in local storage and nullify user info */
    /*Remove persisted cookies in local storage and nullify user info */
    /**
     * @private
     * @return {?}
     */
    NeutrinosOAuthClientService.prototype.destroyClientSession = /*Remove persisted cookies in local storage and nullify user info */
    /**
     * @private
     * @return {?}
     */
    function () {
        this.setUserInfo(null);
        window.localStorage.removeItem('connectSid');
    };
    NeutrinosOAuthClientService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    NeutrinosOAuthClientService.ctorParameters = function () { return [
        { type: UtilService },
        { type: HttpClient }
    ]; };
    /** @nocollapse */ NeutrinosOAuthClientService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NeutrinosOAuthClientService_Factory() { return new NeutrinosOAuthClientService(i0.ɵɵinject(i1.UtilService), i0.ɵɵinject(i2.HttpClient)); }, token: NeutrinosOAuthClientService, providedIn: "root" });
    return NeutrinosOAuthClientService;
}());
export { NeutrinosOAuthClientService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.cookieName;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.currentUserInfo;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.authStateSubject;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.util;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV1dHJpbm9zLW9hdXRoLWNsaWVudC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLW9hdXRoLWNsaWVudC8iLCJzb3VyY2VzIjpbImxpYi9uZXV0cmlub3Mtb2F1dGgtY2xpZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9ELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHlCQUF5QixDQUFDOzs7O0FBS3REO0lBVUUscUNBQW9CLElBQWlCLEVBQVUsSUFBZ0I7UUFBM0MsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUFVLFNBQUksR0FBSixJQUFJLENBQVk7UUFMdkQsZUFBVSxHQUFHLGFBQWEsQ0FBQztRQUczQixxQkFBZ0IsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBR3pDLENBQUM7SUFLRCxzQkFBSSxpREFBUTtRQUhaOztXQUVHOzs7OztRQUNIO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQzlCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksbURBQVU7Ozs7UUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDN0MsQ0FBQzs7O09BQUE7Ozs7OztJQUVPLGlEQUFXOzs7OztJQUFuQixVQUFvQixRQUFRO1FBQzFCLElBQUksQ0FBQyxlQUFlLEdBQUcsUUFBUSxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7Ozs7T0FLRzs7Ozs7Ozs7SUFDSSwyQ0FBSzs7Ozs7OztJQUFaLFVBQWEsZUFBd0I7UUFBckMsaUJBaUJDO1FBaEJDLE9BQU8sSUFBSSxPQUFPOzs7OztRQUFD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bkI7Ozs7Z0JBUFEsV0FBVztnQkFGWCxVQUFVOzs7c0NBRG5CO0NBa1NDLEFBMVJELElBMFJDO1NBdlJZLDJCQUEyQjs7Ozs7O0lBRXRDLGlEQUFtQzs7Ozs7SUFDbkMsc0RBQXdCOzs7OztJQUV4Qix1REFBeUM7Ozs7O0lBRTdCLDJDQUF5Qjs7Ozs7SUFBRSwyQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFV0aWxTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy91dGlsLnNlcnZpY2UnO1xyXG5cclxuZGVjbGFyZSBjb25zdCBjb3Jkb3ZhO1xyXG5kZWNsYXJlIGNvbnN0IGNvb2tpZU1hc3RlcjtcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIE5ldXRyaW5vc09BdXRoQ2xpZW50U2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgY29va2llTmFtZSA9ICdjb25uZWN0LnNpZCc7XHJcbiAgcHJpdmF0ZSBjdXJyZW50VXNlckluZm87XHJcblxyXG4gIHByaXZhdGUgYXV0aFN0YXRlU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdXRpbDogVXRpbFNlcnZpY2UsIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHVzZXIgaW5mbyBhbmQgdG9rZW5zIG9mIHRoZSBjdXJyZW50IGxvZ2dlZCBpbiB1c2VyXHJcbiAgICovXHJcbiAgZ2V0IHVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXJJbmZvO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzTG9nZ2VkSW4oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlckluZm8gPyB0cnVlIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFVzZXJJbmZvKHVzZXJJbmZvKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGVyZm9ybXMgYXV0aGVudGljYXRpb24gYmFzZWQgb24gY29uZmlndXJhdGlvbiBhbmQgcmV0dXJucyB1c2VyIGluZm8gZm9yIG1vYmlsZSBlbnYgYW5kXHJcbiAgICogZm9yIHdlYiBhcHAgdXNlciBpbmZvIGlzIHN0b3JlZCBpbiBtZW1vcnkuIENhbGwgdXNlckluZm8gZ2V0dGVyIG1ldGhvZCB0byByZXRyaWV2ZSB1c2VyaW5mb1xyXG4gICAqIEBwYXJhbSByZWRpcmVjdEJhY2tVcmwgLSB1cmwgdG8gcmVkaXJlY3QgYmFjayB0byB3aGVuIGF1dGhlbnRpY2F0aW9uIGlzIGRvbmUuIFZhbGlkIG9ubHkgZm9yIFdlYi5cclxuICAgKiBGb3IgbW9iaWxlIHVzZSB0aGUgUHJvbWlzZSByZXR1cm5lZCB0byBwZXJmb3JtIHBvc3QgYXV0aGVudGljYXRpb24gYWN0aW9uc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2dpbihyZWRpcmVjdEJhY2tVcmw/OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnV0aWwuZ2V0RW52VmFsdWUoJ2lzSURTRW5hYmxlZCcpID09PSAnZmFsc2UnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCh7IG1lc3NhZ2U6ICdJRFMgaXMgbm90IGVuYWJsZWQgaW4gZW52aXJvbm1lbnRzJyB9KTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy51dGlsLmdldFBsYXRmb3JtVHlwZSgpID09PSAnYnJvd3NlcicpIHtcclxuICAgICAgICB0aGlzLmxvZ2luV2l0aFJlZGlyZWN0KHJlZGlyZWN0QmFja1VybCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMubG9naW5XaXRoSW5BcHBCcm93c2VyKClcclxuICAgICAgICAudGhlbih0b2tlbnNldCA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbnNldCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goYXV0aEVycm9yID0+IHtcclxuICAgICAgICAgIHJldHVybiByZWplY3QoYXV0aEVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbG9naW5VcmwgLSBMb2dpbiB1cmwgd2hlcmUgU1NEIGlzIGhvc3RlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbG9naW5XaXRoSW5BcHBCcm93c2VyKCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3Qgc2NyaXB0VVJMUyA9IFsnL2ludGVyYWN0aW9uLycsICcvYXV0aC1wcm92aWRlci9yZXR1cm4nXTsgLy8gZXhlY3V0ZSBKUyBvbmx5IGZvciB0aGlzIHVybHNcclxuICAgICAgY29uc3Qgc2NyaXB0ID0gYXdhaXQgdGhpcy5nZXRTY3JpcHQoKTsgLy8gR2V0IEpTIHdoaWNoIHN0b3JlcyBndWlkIGFuZCBkZXZpY2UgZGV0YWlscyBpbiBsb2NhbCBzdG9yYWdlIG9mIHdlYnZpZXdcclxuICAgICAgY29uc3QgaW5BcHBCcm93c2VyUmVmID0gY29yZG92YS5JbkFwcEJyb3dzZXIub3Blbih0aGlzLnV0aWwuZ2V0TW9iaWxlTG9naW5VcmwoKSwgJ19ibGFuaycpO1xyXG4gICAgICBjb25zdCBleGVjdXRlU2NyaXB0Q0IgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQuaGFzT3duUHJvcGVydHkoJ3R5cGUnKSAmJiBldmVudC5oYXNPd25Qcm9wZXJ0eSgndXJsJykgJiYgZXZlbnQudHlwZSA9PT0gJ2xvYWRzdG9wJ1xyXG4gICAgICAgICAgJiYgdGhpcy5pc1VSTE1hdGNoKGV2ZW50LnVybCwgc2NyaXB0VVJMUykpIHtcclxuICAgICAgICAgIGluQXBwQnJvd3NlclJlZi5leGVjdXRlU2NyaXB0KHsgY29kZTogc2NyaXB0IH0sICgpID0+IHsgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBpbkFwcEJyb3dzZXJSZWYuYWRkRXZlbnRMaXN0ZW5lcignbG9hZHN0b3AnLCBleGVjdXRlU2NyaXB0Q0IpO1xyXG4gICAgICBjb25zdCBleGl0Q0IgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdCh7IGNvZGU6ICdhdXRoLWNhbmNlbCcsIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBjYW5jZWxsZWQgYnkgdXNlcicgfSk7XHJcbiAgICAgIH07XHJcbiAgICAgIGluQXBwQnJvd3NlclJlZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKG1lc3NhZ2UpID0+IHtcclxuICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLmF1dGggJiYgbWVzc2FnZS5kYXRhLmF1dGggPT09ICdzdWNjZXNzJykge1xyXG4gICAgICAgICAgaW5BcHBCcm93c2VyUmVmLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2V4aXQnLCBleGl0Q0IpO1xyXG4gICAgICAgICAgaW5BcHBCcm93c2VyUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICB0aGlzLnBlcnNpc3RDb29raWVzKCk7XHJcbiAgICAgICAgICB0aGlzLmdldFVzZXJJbmZvKCkudGhlbih0b2tlbnNldCA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHRva2Vuc2V0KTtcclxuICAgICAgICAgIH0pLmNhdGNoKGF1dGhFcnIgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGF1dGhFcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgLy8gc2V0dGxlIHRoZSBwcm9taXNlIGlmIHVzZXIgY2xvc2VkIHRoZSBpbiBhcHAgYnJvd3NlciBtYW51YWxseVxyXG4gICAgICBpbkFwcEJyb3dzZXJSZWYuYWRkRXZlbnRMaXN0ZW5lcignZXhpdCcsIGV4aXRDQik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNVUkxNYXRjaCh1cmwsIGNvbXBhcmVXaXRoOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICByZXR1cm4gY29tcGFyZVdpdGguc29tZSh1ID0+IHVybC5pbmNsdWRlcyh1KSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBKUyBhcyBhIHN0cmluZyB0byBiZSBleGVjdXRlZCBpbiBpbkFwcEJyb3dzZXIgd2hpY2ggc2V0cyBndWlkIGFuZCBkZXZpY2UgZGV0YWlscyBpbiBsb2NhbFN0b3JhZ2VcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldFNjcmlwdCgpIHtcclxuICAgIGNvbnN0IGRldmljZURldGFpbHMgPSBKU09OLnN0cmluZ2lmeSh3aW5kb3dbJ2RldmljZSddKSB8fCB7fTtcclxuICAgIGNvbnN0IGd1aWQgPSBhd2FpdCB0aGlzLmdldHVuaXF1ZURldmljZUlEKCk7XHJcbiAgICBjb25zdCBndWlkU2NyaXB0ID0gZ3VpZCA/IGBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ3VpZCcsICcke2d1aWR9JylgIDogJyc7XHJcbiAgICBjb25zdCBzY3JpcHQgPSBgJHtndWlkU2NyaXB0fVxyXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FkZGl0aW9uYWxJbmZvJywgJyR7ZGV2aWNlRGV0YWlsc30nKVxyXG4gICAgICAgICAgd2luZG93LmlzU2NyaXB0RXhlY3V0ZWQgPSB0cnVlO2A7XHJcbiAgICByZXR1cm4gc2NyaXB0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXR1bmlxdWVEZXZpY2VJRCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHdpbmRvd1sncGx1Z2lucyddLnVuaXF1ZURldmljZUlELmdldCgoZ3VpZCkgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGd1aWQpO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgcHVibGljIGdldFVzZXJJbmZvKCk6IFByb21pc2U8e30+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCk7XHJcbiAgICAgIC8qRWRnZSBjYXNlOiBVc2VyaW5mbyBpcyByZXRyZWl2ZWQgZnJvbSBjYWNoZSB3aGVuIGxvZ2luIHBhZ2UgaXMgb3BlbmVkIGFuZCB1c2VyIGNhbmNlbHMgdGhlIGxvZ2luIGF0dGVtcHQgICovXHJcbiAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ2FjaGUtQ29udHJvbCcsICduby1jYWNoZScpO1xyXG4gICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ1ByYWdtYScsICduby1jYWNoZScpO1xyXG4gICAgICB0aGlzLmh0dHAuZ2V0KHRoaXMudXRpbC5nZXRVc2VySW5mb1VybCgpLCB7IGhlYWRlcnMgfSkuc3Vic2NyaWJlKHRva2Vuc2V0ID0+IHtcclxuICAgICAgICB0aGlzLnNldFVzZXJJbmZvKHRva2Vuc2V0KTtcclxuICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbnNldCk7XHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3lDbGllbnRTZXNzaW9uKCk7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKklmIFNTRCB0aHJvd3MgNDAxIGR1cmluZyBhbnkgaHR0cCByZXF1ZXN0IGR1ZSB0byByZWZyZXNoIHRva2VuIGV4cGlyeSwgY29va2llIGV4cGlyeSBvciBhY2Nlc3MgcmV2b2tlIG51bGxpZnkgdGhlIHVzZXJpbmZvIGluIG1lbW9yeVxyXG4gIGFuZCBlbWl0IGF1dGhTdGF0ZSBldmVudCAgKi9cclxuICBwdWJsaWMgcmVtb3ZlVXNlckluZm8oZXJyb3JSZXNwb25zZSkge1xyXG4gICAgdGhpcy5kZXN0cm95Q2xpZW50U2Vzc2lvbigpO1xyXG4gICAgdGhpcy5hdXRoU3RhdGVTdWJqZWN0Lm5leHQoZXJyb3JSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGV2ZW50IHdoZW4gQXV0aCBzdGF0ZSBoYXMgY2hhbmdlZCBkdWUgdG8gc2Vzc2lvbiBleHBpcnksIGFjY2VzcyByZXZva2Ugb3IgY29va2llIGV4cGlyeS5cclxuICAgKi9cclxuICBwdWJsaWMgYXV0aFN0YXRlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5hdXRoU3RhdGVTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2dpbldpdGhSZWRpcmVjdChyZWRpcmVjdEJhY2tVcmwpOiB2b2lkIHtcclxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdGhpcy51dGlsLmdldFdlYkxvZ2luVXJsKHJlZGlyZWN0QmFja1VybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQZXJzaXN0cyBjb29raWVzIGluIGxvY2FsU3RvcmFnZSB0byBiZSB1c2VkIGR1cmluZyBuZXh0IGFwcCBsYXVuY2ggb25seSBmb3IgSU9TXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwZXJzaXN0Q29va2llcygpIHtcclxuICAgIGlmICh3aW5kb3dbJ2RldmljZSddICYmIHdpbmRvd1snZGV2aWNlJ10ucGxhdGZvcm0gPT09ICdpT1MnKSB7XHJcbiAgICAgIHRoaXMuZ2V0Q29va2llKHRoaXMuY29va2llTmFtZSwgdGhpcy51dGlsLmdldFNTREJhc2VQYXRoKCkpXHJcbiAgICAgICAgLnRoZW4oY29ubmVjdFNpZCA9PiB7XHJcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY29ubmVjdFNpZCcsIGNvbm5lY3RTaWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdG9yZXMgdGhlIGNvbm5lY3Quc2lkIGNvb2tpZSBmcm9tIHNlc3Npb24gc3RvcmFnZSBkdXJpbmcgYXBwIGJvb3RzdHJhcCBpZiBkZXZpY2UgaXMgbW9iaWxlXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIHJlc3RvcmVDb29raWVzKCkge1xyXG4gICAgY29uc3QgY29ubmVjdFNpZENvb2tpZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjb25uZWN0U2lkJyk7XHJcbiAgICBpZiAoIWNvbm5lY3RTaWRDb29raWUpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2V0Q29va2llKHRoaXMudXRpbC5nZXRTU0RCYXNlUGF0aCgpLCB0aGlzLmNvb2tpZU5hbWUsIGNvbm5lY3RTaWRDb29raWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKiBAcGFyYW0gdXJsIC0gc2l0ZSB3aGVyZSB0aGUgY29va2llIGlzIHN0b3JlZFxyXG4gICAqIEBwYXJhbSBjb29raWVOYW1lIC0gbmFtZSBvZiB0aGUgY29va2llIHRvIHJlc3RvcmVcclxuICAgKiBAcGFyYW0gY29va2llVmFsdWUgLSB2YWx1ZSBvZiB0aGUgY29va2llIHRvIHJlc3RvcmVcclxuICAgKi9cclxuICBwcml2YXRlIHNldENvb2tpZSh1cmw6IHN0cmluZywgY29va2llTmFtZTogc3RyaW5nLCBjb29raWVWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb29raWVNYXN0ZXIuc2V0Q29va2llVmFsdWUodXJsLCBjb29raWVOYW1lLCBjb29raWVWYWx1ZSwgKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHRydWUpO1xyXG4gICAgICB9LCAoZXJyb3IpID0+IHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtICBjb29raWVOYW1lIC0gbmFtZSBvZiB0aGUgY29va2llIHRvIHJldHJpZXZlXHJcbiAgICogQHBhcmFtICAgdXJsIC0gc2l0ZSB3aGVyZSB0aGUgY29va2llIGlzIHN0b3JlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Q29va2llKGNvb2tpZU5hbWU6IHN0cmluZywgdXJsOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29va2llTWFzdGVyLmdldENvb2tpZVZhbHVlKHVybCwgY29va2llTmFtZSwgKGNvb2tpZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGNvb2tpZS5jb29raWVWYWx1ZSk7XHJcbiAgICAgIH0sIChlcnJvcikgPT4ge1xyXG4gICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9nb3V0IHRoZSBjdXJyZW50IHVzZXIsIGRlc3Ryb3lzIHNlc3Npb24gYmV0d2VlbiBjbGllbnQgYW5kIHNlcnZlci5cclxuICAgKiBAcGFyYW0gcmVkaXJlY3RCYWNrVXJsIC0gVVJMIHdoZXJlIHRoZSB1c2VyIGlzIG5hdmlnYXRlZCBwb3N0IGxvZ291dC4gVmFsaWQgb25seSBmb3IgV2ViLlxyXG4gICAqIEZvciBtb2JpbGUgdXNlIHRoZSBQcm9taXNlIHJldHVybmVkIHRvIHBlcmZvcm0gcG9zdCBhdXRoZW50aWNhdGlvbiBhY3Rpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGxvZ291dChyZWRpcmVjdEJhY2tVcmw/OiBzdHJpbmcpOiBQcm9taXNlPHt9PiB7XHJcbiAgICBjb25zdCBsb2dvdXRVcmwgPSAodGhpcy51dGlsLmdldFBsYXRmb3JtVHlwZSgpID09PSAnYnJvd3NlcicpID8gdGhpcy51dGlsLmdldFdlYkxvZ291dFVybChyZWRpcmVjdEJhY2tVcmwpXHJcbiAgICAgIDogdGhpcy51dGlsLmdldE1vYmlsZUxvZ291dFVybCgpO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5odHRwLmdldChsb2dvdXRVcmwpLnN1YnNjcmliZShpZHNMb2dvdXRJbmZvID0+IHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3lJRFNTZXNzaW9uKGlkc0xvZ291dEluZm8pXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGxvZ291dEVyciA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWplY3QobG9nb3V0RXJyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9LCBsb2dvdXRFcnJvciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlamVjdChsb2dvdXRFcnJvcik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlc3Ryb3lJRFNTZXNzaW9uKGlkc0luZm8pIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGlmIChpZHNJbmZvWydzZXNzaW9uRXhpc3RzJ10gPT09IGZhbHNlKSB7XHJcbiAgICAgICAgLy8gTm8gc2Vzc2lvbiBwcmVzZW50IHdpdGggU1NEIGR1ZSB0byBjb29raWUgZXhwaXJ5XHJcbiAgICAgICAgdGhpcy5kZXN0cm95Q2xpZW50U2Vzc2lvbigpO1xyXG4gICAgICAgIHRoaXMuYXV0aFN0YXRlU3ViamVjdC5uZXh0KHsgY29kZTogJ05PX1NFU1NJT04nLCBtZXNzYWdlOiAnVXNlciBzZXNzaW9uIGhhcyBhbHJlYWR5IGV4cGlyZWQnIH0pO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMudXRpbC5nZXRQbGF0Zm9ybVR5cGUoKSA9PT0gJ2Jyb3dzZXInKSB7XHJcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBpZHNJbmZvWydpZHNVUkwnXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmxvZ291dFdpdGhJbmFwcEJyb3dzZXIoaWRzSW5mb1snaWRzVVJMJ10pXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKHNlc3Npb25FcnJvciA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoc2Vzc2lvbkVycm9yKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGlkc0xvZ291dFVybCAtIElEUyBsb2dvdXQgdXJsXHJcbiAgICogT3BlbnMgSW5BcHAgYnJvd3NlciBhbmQgZGVzdHJveXMgdGhlIHNlc3Npb25cclxuICAgKi9cclxuICBwcml2YXRlIGxvZ291dFdpdGhJbmFwcEJyb3dzZXIoaWRzTG9nb3V0VXJsOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4aXRDQiA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gcmVqZWN0KHsgY29kZTogJ2F1dGgtY2FuY2VsJywgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIGNhbmNlbGxlZCBieSB1c2VyJyB9KTtcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgaW5BcHBCcm93c2VyUmVmID0gY29yZG92YS5JbkFwcEJyb3dzZXIub3BlbihpZHNMb2dvdXRVcmwsICdfYmxhbmsnKTtcclxuICAgICAgaW5BcHBCcm93c2VyUmVmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAobWVzc2FnZSkgPT4ge1xyXG4gICAgICAgIC8vIFJlbW92ZSBleGl0IGxpc3RlbmVyIGlmIHNjcmlwdCBjbG9zZWQgdGhlIGluIGFwcCBicm93c2VyXHJcbiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZS5kYXRhICYmIG1lc3NhZ2UuZGF0YS5hdXRoICYmIG1lc3NhZ2UuZGF0YS5hdXRoID09PSAnc3VjY2VzcycpIHtcclxuICAgICAgICAgIGluQXBwQnJvd3NlclJlZi5yZW1vdmVFdmVudExpc3RlbmVyKCdleGl0JywgZXhpdENCKTtcclxuICAgICAgICAgIGluQXBwQnJvd3NlclJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgdGhpcy5kZXN0cm95Q2xpZW50U2Vzc2lvbigpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyBzZXR0bGUgdGhlIHByb21pc2UgaWYgdXNlciBjbG9zZWQgdGhlIGluIGFwcCBicm93c2VyIG1hbnVhbGx5XHJcbiAgICAgIGluQXBwQnJvd3NlclJlZi5hZGRFdmVudExpc3RlbmVyKCdleGl0JywgZXhpdENCKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLypSZW1vdmUgcGVyc2lzdGVkIGNvb2tpZXMgaW4gbG9jYWwgc3RvcmFnZSBhbmQgbnVsbGlmeSB1c2VyIGluZm8gKi9cclxuICBwcml2YXRlIGRlc3Ryb3lDbGllbnRTZXNzaW9uKCkge1xyXG4gICAgdGhpcy5zZXRVc2VySW5mbyhudWxsKTtcclxuICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY29ubmVjdFNpZCcpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19