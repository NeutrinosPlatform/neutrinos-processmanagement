/**
 * @fileoverview added by tsickle
 * Generated from: lib/cookie-interceptor.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { UtilService } from './services/util.service';
import { NeutrinosOAuthClientService } from './neutrinos-oauth-client.service';
import * as i0 from "@angular/core";
import * as i1 from "./services/util.service";
import * as i2 from "./neutrinos-oauth-client.service";
export class CookieInterceptorService {
    /**
     * @param {?} utilService
     * @param {?} neutrinosOAuthClientService
     */
    constructor(utilService, neutrinosOAuthClientService) {
        this.utilService = utilService;
        this.neutrinosOAuthClientService = neutrinosOAuthClientService;
    }
    /**
     * @param {?} request
     * @param {?} next
     * @return {?}
     */
    intercept(request, next) {
        /* withCredentials adds cookies to the request for cross site (Only ssd urls).*/
        /** @type {?} */
        const baseUrl = this.utilService.getSSDBasePath();
        /** @type {?} */
        const isSSD = (baseUrl !== '' && request.url.includes(baseUrl));
        if (isSSD && this.isCrossDomain(baseUrl)) {
            request = request.clone({
                withCredentials: true
            });
        }
        return next.handle(request).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            return event;
        })), catchError((/**
         * @param {?} errorResponse
         * @return {?}
         */
        (errorResponse) => {
            /*Intercept all requests and remove userinfo and cookies when status is 401 with code SESSION_EXPIRED, which means
            * cookies have expired or access has been revoked by the OAuth providers hence IDS rejected.  */
            if (errorResponse && errorResponse.hasOwnProperty('status') && errorResponse.status === 401 &&
                errorResponse.error.hasOwnProperty('code')) {
                this.neutrinosOAuthClientService.removeUserInfo(errorResponse.error);
            }
            return throwError(errorResponse);
        })));
    }
    /**
     * Returns true is the ssd url is running on a different domain than where UI is hosted.
     * For mobile Returns false always since UI is already bundled with cordova
     * If the user is not using IDS and is cross domain isIDSEnabled can be set to false to skip adding withCredentials
     * @private
     * @param {?} ssdUrl - string
     * @return {?}
     */
    isCrossDomain(ssdUrl) {
        try {
            ssdUrl = new URL(ssdUrl);
            return (this.utilService.getPlatformType() === 'browser' && (ssdUrl.host !== location.host)
                && this.utilService.getEnvValue('isIDSEnabled') === 'true');
        }
        catch (e) {
            console.error(e);
        }
    }
}
CookieInterceptorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
CookieInterceptorService.ctorParameters = () => [
    { type: UtilService },
    { type: NeutrinosOAuthClientService }
];
/** @nocollapse */ CookieInterceptorService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CookieInterceptorService_Factory() { return new CookieInterceptorService(i0.ɵɵinject(i1.UtilService), i0.ɵɵinject(i2.NeutrinosOAuthClientService)); }, token: CookieInterceptorService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    CookieInterceptorService.prototype.utilService;
    /**
     * @type {?}
     * @private
     */
    CookieInterceptorService.prototype.neutrinosOAuthClientService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLWludGVyY2VwdG9yLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZXV0cmlub3Mtb2F1dGgtY2xpZW50LyIsInNvdXJjZXMiOlsibGliL2Nvb2tpZS1pbnRlcmNlcHRvci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQWMsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzlDLE9BQU8sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3RELE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7O0FBSy9FLE1BQU0sT0FBTyx3QkFBd0I7Ozs7O0lBRW5DLFlBQW9CLFdBQXdCLEVBQVUsMkJBQXdEO1FBQTFGLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsZ0NBQTJCLEdBQTNCLDJCQUEyQixDQUE2QjtJQUFJLENBQUM7Ozs7OztJQUVuSCxTQUFTLENBQUMsT0FBeUIsRUFBRSxJQUFpQjs7O2NBRzlDLE9BQU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRTs7Y0FDM0MsS0FBSyxHQUFHLENBQUMsT0FBTyxLQUFLLEVBQUUsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvRCxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3hDLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO2dCQUN0QixlQUFlLEVBQUUsSUFBSTthQUN0QixDQUFDLENBQUM7U0FDSjtRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzNDLE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQyxFQUFDLEVBQUUsVUFBVTs7OztRQUFDLENBQUMsYUFBZ0MsRUFBRSxFQUFFO1lBQ2xEOzRHQUNnRztZQUNoRyxJQUFJLGFBQWEsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssR0FBRztnQkFDekYsYUFBYSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzVDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ3RFO1lBQ0QsT0FBTyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNOLENBQUM7Ozs7Ozs7OztJQVFPLGFBQWEsQ0FBQyxNQUFNO1FBQzFCLElBQUk7WUFDRixNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekIsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFLEtBQUssU0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxDQUFDO21CQUN0RixJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsS0FBSyxNQUFNLENBQUMsQ0FBQztTQUMvRDtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNsQjtJQUVILENBQUM7OztZQTdDRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7Ozs7WUFMUSxXQUFXO1lBQ1gsMkJBQTJCOzs7Ozs7OztJQU90QiwrQ0FBZ0M7Ozs7O0lBQUUsK0RBQWdFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwUmVxdWVzdCwgSHR0cEhhbmRsZXIsIEh0dHBFdmVudCwgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBVdGlsU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvdXRpbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmV1dHJpbm9zT0F1dGhDbGllbnRTZXJ2aWNlIH0gZnJvbSAnLi9uZXV0cmlub3Mtb2F1dGgtY2xpZW50LnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29va2llSW50ZXJjZXB0b3JTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSB1dGlsU2VydmljZTogVXRpbFNlcnZpY2UsIHByaXZhdGUgbmV1dHJpbm9zT0F1dGhDbGllbnRTZXJ2aWNlOiBOZXV0cmlub3NPQXV0aENsaWVudFNlcnZpY2UpIHsgfVxyXG5cclxuICBpbnRlcmNlcHQocmVxdWVzdDogSHR0cFJlcXVlc3Q8YW55PiwgbmV4dDogSHR0cEhhbmRsZXIpOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxhbnk+PiB7XHJcblxyXG4gICAgLyogd2l0aENyZWRlbnRpYWxzIGFkZHMgY29va2llcyB0byB0aGUgcmVxdWVzdCBmb3IgY3Jvc3Mgc2l0ZSAoT25seSBzc2QgdXJscykuKi9cclxuICAgIGNvbnN0IGJhc2VVcmwgPSB0aGlzLnV0aWxTZXJ2aWNlLmdldFNTREJhc2VQYXRoKCk7XHJcbiAgICBjb25zdCBpc1NTRCA9IChiYXNlVXJsICE9PSAnJyAmJiByZXF1ZXN0LnVybC5pbmNsdWRlcyhiYXNlVXJsKSk7XHJcbiAgICBpZiAoaXNTU0QgJiYgdGhpcy5pc0Nyb3NzRG9tYWluKGJhc2VVcmwpKSB7XHJcbiAgICAgIHJlcXVlc3QgPSByZXF1ZXN0LmNsb25lKHtcclxuICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxdWVzdCkucGlwZShtYXAoZXZlbnQgPT4ge1xyXG4gICAgICByZXR1cm4gZXZlbnQ7XHJcbiAgICB9KSwgY2F0Y2hFcnJvcigoZXJyb3JSZXNwb25zZTogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgLypJbnRlcmNlcHQgYWxsIHJlcXVlc3RzIGFuZCByZW1vdmUgdXNlcmluZm8gYW5kIGNvb2tpZXMgd2hlbiBzdGF0dXMgaXMgNDAxIHdpdGggY29kZSBTRVNTSU9OX0VYUElSRUQsIHdoaWNoIG1lYW5zXHJcbiAgICAgICogY29va2llcyBoYXZlIGV4cGlyZWQgb3IgYWNjZXNzIGhhcyBiZWVuIHJldm9rZWQgYnkgdGhlIE9BdXRoIHByb3ZpZGVycyBoZW5jZSBJRFMgcmVqZWN0ZWQuICAqL1xyXG4gICAgICBpZiAoZXJyb3JSZXNwb25zZSAmJiBlcnJvclJlc3BvbnNlLmhhc093blByb3BlcnR5KCdzdGF0dXMnKSAmJiBlcnJvclJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICYmXHJcbiAgICAgICAgZXJyb3JSZXNwb25zZS5lcnJvci5oYXNPd25Qcm9wZXJ0eSgnY29kZScpKSB7XHJcbiAgICAgICAgdGhpcy5uZXV0cmlub3NPQXV0aENsaWVudFNlcnZpY2UucmVtb3ZlVXNlckluZm8oZXJyb3JSZXNwb25zZS5lcnJvcik7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3JSZXNwb25zZSk7XHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRydWUgaXMgdGhlIHNzZCB1cmwgaXMgcnVubmluZyBvbiBhIGRpZmZlcmVudCBkb21haW4gdGhhbiB3aGVyZSBVSSBpcyBob3N0ZWQuXHJcbiAgICogRm9yIG1vYmlsZSBSZXR1cm5zIGZhbHNlIGFsd2F5cyBzaW5jZSBVSSBpcyBhbHJlYWR5IGJ1bmRsZWQgd2l0aCBjb3Jkb3ZhXHJcbiAgICogSWYgdGhlIHVzZXIgaXMgbm90IHVzaW5nIElEUyBhbmQgaXMgY3Jvc3MgZG9tYWluIGlzSURTRW5hYmxlZCBjYW4gYmUgc2V0IHRvIGZhbHNlIHRvIHNraXAgYWRkaW5nIHdpdGhDcmVkZW50aWFsc1xyXG4gICAqIEBwYXJhbSBzc2RVcmwgLSBzdHJpbmdcclxuICAgKi9cclxuICBwcml2YXRlIGlzQ3Jvc3NEb21haW4oc3NkVXJsKTogYm9vbGVhbiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBzc2RVcmwgPSBuZXcgVVJMKHNzZFVybCk7XHJcbiAgICAgIHJldHVybiAodGhpcy51dGlsU2VydmljZS5nZXRQbGF0Zm9ybVR5cGUoKSA9PT0gJ2Jyb3dzZXInICYmIChzc2RVcmwuaG9zdCAhPT0gbG9jYXRpb24uaG9zdClcclxuICAgICAgICAmJiB0aGlzLnV0aWxTZXJ2aWNlLmdldEVudlZhbHVlKCdpc0lEU0VuYWJsZWQnKSA9PT0gJ3RydWUnKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxufVxyXG4iXX0=