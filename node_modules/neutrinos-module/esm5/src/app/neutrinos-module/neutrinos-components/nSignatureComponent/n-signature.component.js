import { __decorate } from "tslib";
/*DEFAULT GENERATED TEMPLATE. DO NOT CHANGE SELECTOR TEMPLATE_URL AND CLASS NAME*/
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import * as signing from 'signature_pad';
// import { MatSnackBar } from '@angular/material';
/**
* Model import Example :
* import { HERO } from '../models/hero.model';
*/
/**
 * Service import Example :
 * import { HeroService } from '../services/hero/hero.service';
 */
var NSignatureComponent = /** @class */ (function () {
    function NSignatureComponent() {
        this.imageDataValue = '';
        this.signaturePad = '';
        this.mode = 'responsive'; // 'click-fullscreen' or 'responsive'
        this.canvasMode = 'responsive'; // 'responsive' or 'fullscreen'
        this.imageDataChange = new EventEmitter();
    }
    Object.defineProperty(NSignatureComponent.prototype, "imageData", {
        get: function () {
            return this.imageDataValue;
        },
        set: function (val) {
            this.imageDataValue = val;
            if (val || val === '' || this.isDataURL(val)) {
                this.saveCavas(val);
            }
            this.imageDataChange.emit(this.imageDataValue);
        },
        enumerable: true,
        configurable: true
    });
    NSignatureComponent.prototype.ngAfterViewInit = function () {
        if (this.mode === 'responsive') {
            this.createCanvas();
        }
    };
    NSignatureComponent.prototype.createCanvas = function () {
        this.fitToContainer(this.signaturecanvas.nativeElement);
        this.signaturePad = new signing.default(this.signaturecanvas.nativeElement, this.assignOptions());
    };
    NSignatureComponent.prototype.saveCavas = function (dataUrl) {
        if (this.signaturePad) {
            if (this.signaturePad.isEmpty() || dataUrl === '') {
                this.savedData = '';
                this.signaturePad.clear();
            }
            else if (this.isDataURL(dataUrl)) {
                this.signaturePad.fromDataURL(dataUrl);
                this.savedData = this.signaturePad.toData();
            }
            else {
                this.imageData = this.signaturePad.toDataURL();
                if (this.mode === 'click-fullscreen') {
                    this.savedData = this.signaturePad.toData();
                    this.hideCanvas();
                }
            }
        }
    };
    NSignatureComponent.prototype.clearCanvas = function () {
        this.signaturePad.clear();
        // this.fitToContainer(this.signaturecanvas.nativeElement);
    };
    NSignatureComponent.prototype.undoCanvas = function () {
        var data = this.signaturePad.toData();
        if (data) {
            data.pop(); // remove the last dot or line
            this.signaturePad.fromData(data);
        }
    };
    NSignatureComponent.prototype.showCanvas = function () {
        this.classAbs = true;
        this.canvasMode = 'fullscreen';
        if (!this.signaturePad) {
            this.createCanvas();
        }
        this.fitToContainer(this.signaturecanvas.nativeElement, document.body.clientHeight, document.body.clientWidth);
        this.clearCanvas();
        this.createCanvasFromData();
    };
    NSignatureComponent.prototype.hideCanvas = function () {
        this.canvasMode = 'responsive';
    };
    // cancel currently drawn
    NSignatureComponent.prototype.cancel = function () {
        this.savedData = Object.assign([], this.previousSavedData);
    };
    NSignatureComponent.prototype.createCanvasFromData = function () {
        if (this.savedData) {
            this.previousSavedData = Object.assign({}, this.savedData);
            this.signaturePad.fromData(this.savedData);
        }
    };
    NSignatureComponent.prototype.fitToContainer = function (element, height, width) {
        element.style.width = '100%';
        element.style.height = 'calc(100% - 56px)';
        if (height && width) {
            element.width = width;
            element.height = height - 56;
        }
        else {
            element.width = element.offsetWidth;
            element.height = element.offsetHeight;
        }
    };
    NSignatureComponent.prototype.assignOptions = function () {
        var options = {};
        options['backgroundColor'] = this.checkIfValidValueAndRGB(this.backgroundColor, 'backgroundColor');
        options['dotSize'] = this.checkIfValidValueAndNumber(this.dotSize, 'dotSize');
        options['minWidth'] = this.checkIfValidValueAndNumber(this.minWidth, 'minWidth');
        options['maxWidth'] = this.checkIfValidValueAndNumber(this.maxWidth, 'maxWidth');
        options['throttle'] = this.checkIfValidValueAndNumber(this.throttle, 'throttle');
        options['minDistance'] = this.checkIfValidValueAndNumber(this.minDistance, 'minDistance');
        options['penColor'] = this.checkIfValidValueAndRGB(this.penColor, 'penColor');
        options['velocityFilterWeight'] = this.checkIfValidValueAndNumber(this.velocityFilterWeight, 'velocityFilterWeight');
        options = JSON.parse(JSON.stringify(options)); // removing all undefined fields
        options['onBegin'] = this.checkIfValidValueAndFunction(this.onBegin, 'onBegin');
        options['onEnd'] = this.checkIfValidValueAndFunction(this.onEnd, 'onEnd');
        return options;
    };
    NSignatureComponent.prototype.checkIfValidValueAndNumber = function (num, name) {
        if (this.checkIfValid(num) && this.checkNumber(num)) {
            return num;
        }
        this.invalidToast(name, 'num');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValidValueAndRGB = function (color, name) {
        if (this.checkIfValid(color) && this.checkRGB(color)) {
            return color;
        }
        this.invalidToast(name, 'rgb');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValidValueAndFunction = function (fn, name) {
        if (this.checkIfValid(fn) && this.checkIfValidFunction(fn)) {
            return fn;
        }
        this.invalidToast(name, 'function format');
        return undefined;
    };
    NSignatureComponent.prototype.checkIfValid = function (value) {
        return (value !== undefined && value !== null) ? value : undefined;
    };
    NSignatureComponent.prototype.checkNumber = function (num) {
        return !this.checkIsNan(Number(num)) ? Number(num) : undefined;
    };
    NSignatureComponent.prototype.checkIfValidFunction = function (fn) {
        return typeof fn === 'function' ? fn : undefined;
    };
    NSignatureComponent.prototype.checkRGB = function (color) {
        var matchColors1 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/);
        var matchColors2 = new RegExp(/rgb\((\d{1,3}),[ \t]+(\d{1,3}),(\d{1,3})\)/);
        var matchColors3 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),[ \t]+(\d{1,3})\)/);
        return matchColors1.test(color) || matchColors2.test(color) || matchColors3.test(color);
    };
    NSignatureComponent.prototype.checkIsNan = function (value) {
        return Number.isNaN(value);
    };
    NSignatureComponent.prototype.invalidToast = function (optionName, optionType) {
        switch (optionType) {
            case 'num':
                // this.snackbar.open(`Invalid ${optionName} (number or float) given, taking default value instead.`, 'OK');
                break;
            case 'rgb':
                // this.snackbar.open(`Invalid ${optionName} format Eg: rgb(255, 255, 255)  given, taking default value instead.`, 'OK');
                break;
        }
        return;
    };
    NSignatureComponent.prototype.isDataURL = function (s) {
        if (s) {
            var regex = /^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;
            return !!s.match(regex);
        }
        else {
            return false;
        }
    };
    __decorate([
        ViewChild('signaturecanvas', { static: false })
    ], NSignatureComponent.prototype, "signaturecanvas", void 0);
    __decorate([
        ViewChild('canvasparent', { static: false })
    ], NSignatureComponent.prototype, "canvasparent", void 0);
    __decorate([
        Input('backgroundColor')
    ], NSignatureComponent.prototype, "backgroundColor", void 0);
    __decorate([
        Input('dotSize')
    ], NSignatureComponent.prototype, "dotSize", void 0);
    __decorate([
        Input('minWidth')
    ], NSignatureComponent.prototype, "minWidth", void 0);
    __decorate([
        Input('maxWidth')
    ], NSignatureComponent.prototype, "maxWidth", void 0);
    __decorate([
        Input('throttle')
    ], NSignatureComponent.prototype, "throttle", void 0);
    __decorate([
        Input('minDistance')
    ], NSignatureComponent.prototype, "minDistance", void 0);
    __decorate([
        Input('penColor')
    ], NSignatureComponent.prototype, "penColor", void 0);
    __decorate([
        Input('velocityFilterWeight')
    ], NSignatureComponent.prototype, "velocityFilterWeight", void 0);
    __decorate([
        Input('onBegin')
    ], NSignatureComponent.prototype, "onBegin", void 0);
    __decorate([
        Input('onEnd')
    ], NSignatureComponent.prototype, "onEnd", void 0);
    __decorate([
        Input('mode')
    ], NSignatureComponent.prototype, "mode", void 0);
    __decorate([
        Output()
    ], NSignatureComponent.prototype, "imageDataChange", void 0);
    __decorate([
        Input()
    ], NSignatureComponent.prototype, "imageData", null);
    NSignatureComponent = __decorate([
        Component({
            selector: 'n-signature',
            template: "<div fxFill fxLayout=\"row\" *ngIf=\"mode == 'click-fullscreen' && canvasMode !== 'fullscreen'\" class=\"signature-component-border\">\r\n    <div fxFlex=\"calc(100%-56px)\" fxLayout=\"column\">\r\n        <img *ngIf=\"imageDataValue\" [src]=\"imageDataValue\" fxFill/>\r\n    </div>\r\n    <div fxFlex=\"56px\" fxLayoutAlign=\" center\" class=\"signature-component-border\">\r\n        <button mat-icon-button (click)=\"showCanvas()\">\r\n            <mat-icon>mode_edit</mat-icon>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div fxFill fxLayout=\"column\" class=\"signature-component-border\" [fxShow]=\"(mode == 'click-fullscreen' && canvasMode == 'fullscreen') || mode == 'responsive'\" [ngClass]=\"{'signature-canvas-fullscreen': classAbs}\">\r\n    <canvas #signaturecanvas></canvas>\r\n    <div fxFlex=\"56px\" fxLayoutAlign=\"center center\" class=\"signature-component-border\">\r\n        <button mat-icon-button (click)=\"undoCanvas()\">\r\n            <mat-icon>undo</mat-icon>\r\n        </button>\r\n        <button mat-icon-button (click)=\"clearCanvas()\">\r\n            <mat-icon>loop</mat-icon>\r\n        </button>\r\n        <button mat-icon-button (click)=\"saveCavas()\">\r\n            <mat-icon>save</mat-icon>\r\n        </button>\r\n        <button mat-icon-button (click)=\"canvasMode = 'responsive'; cancel()\">\r\n            <mat-icon>clear</mat-icon>\r\n        </button>\r\n    </div>\r\n</div>",
            styles: ["\n     :host { height: 100% !important; }\n     .signature-canvas-fullscreen {\n         position: absolute;\n         top: 0;\n         bottom: 0;\n         right: 0;\n         left: 0;\n     }\n     .signature-component-border {\n         border: 2px solid black;\n     }\n    "]
        })
    ], NSignatureComponent);
    return NSignatureComponent;
}());
export { NSignatureComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibi1zaWduYXR1cmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbmV1dHJpbm9zLW1vZHVsZS9uZXV0cmlub3MtY29tcG9uZW50cy9uU2lnbmF0dXJlQ29tcG9uZW50L24tc2lnbmF0dXJlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0ZBQWtGO0FBQ2xGLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEtBQUssT0FBTyxNQUFNLGVBQWUsQ0FBQztBQUN6QyxtREFBbUQ7QUFDbkQ7OztFQUdFO0FBRUY7OztHQUdHO0FBb0JIO0lBQUE7UUFFSSxtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNaLGlCQUFZLEdBQVEsRUFBRSxDQUFDO1FBZWhCLFNBQUksR0FBRyxZQUFZLENBQUMsQ0FBQyxxQ0FBcUM7UUFDekUsZUFBVSxHQUFHLFlBQVksQ0FBQyxDQUFDLCtCQUErQjtRQUtoRCxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFxTG5ELENBQUM7SUFuTEcsc0JBQUksMENBQVM7YUFBYjtZQUNJLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUMvQixDQUFDO2FBRUQsVUFBYyxHQUFHO1lBQ2IsSUFBSSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUM7WUFDMUIsSUFBSSxHQUFHLElBQUksR0FBRyxLQUFLLEVBQUUsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUMxQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3ZCO1lBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25ELENBQUM7OztPQVJBO0lBVUQsNkNBQWUsR0FB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Q0FBQyxTQUFTLENBQUM7d0RBQVM7SUFDUDtRQUFsQixLQUFLLENBQUMsVUFBVSxDQUFDO3lEQUFVO0lBQ1Q7UUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzt5REFBVTtJQUNUO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7eURBQVU7SUFDTjtRQUFyQixLQUFLLENBQUMsYUFBYSxDQUFDOzREQUFhO0lBQ2Y7UUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzt5REFBVTtJQUNHO1FBQTlCLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQztxRUFBc0I7SUFDbEM7UUFBakIsS0FBSyxDQUFDLFNBQVMsQ0FBQzt3REFBUztJQUNWO1FBQWYsS0FBSyxDQUFDLE9BQU8sQ0FBQztzREFBTztJQUNQO1FBQWQsS0FBSyxDQUFDLE1BQU0sQ0FBQztxREFBcUI7SUFNekI7UUFBVCxNQUFNLEVBQUU7Z0VBQXNDO0lBRS9DO1FBREMsS0FBSyxFQUFFO3dEQUdQO0lBNUJRLG1CQUFtQjtRQWxCL0IsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLGFBQWE7WUFDdkIsbzZDQUEwQztxQkFDakMseVJBWVI7U0FDSixDQUFDO09BRVcsbUJBQW1CLENBNk0vQjtJQUFELDBCQUFDO0NBQUEsQUE3TUQsSUE2TUM7U0E3TVksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiLypERUZBVUxUIEdFTkVSQVRFRCBURU1QTEFURS4gRE8gTk9UIENIQU5HRSBTRUxFQ1RPUiBURU1QTEFURV9VUkwgQU5EIENMQVNTIE5BTUUqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCAqIGFzIHNpZ25pbmcgZnJvbSAnc2lnbmF0dXJlX3BhZCc7XHJcbi8vIGltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xyXG4vKipcclxuKiBNb2RlbCBpbXBvcnQgRXhhbXBsZSA6XHJcbiogaW1wb3J0IHsgSEVSTyB9IGZyb20gJy4uL21vZGVscy9oZXJvLm1vZGVsJztcclxuKi9cclxuXHJcbi8qKlxyXG4gKiBTZXJ2aWNlIGltcG9ydCBFeGFtcGxlIDpcclxuICogaW1wb3J0IHsgSGVyb1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9oZXJvL2hlcm8uc2VydmljZSc7XHJcbiAqL1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ24tc2lnbmF0dXJlJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9uLXNpZ25hdHVyZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgIHN0eWxlczogW2BcclxuICAgICA6aG9zdCB7IGhlaWdodDogMTAwJSAhaW1wb3J0YW50OyB9XHJcbiAgICAgLnNpZ25hdHVyZS1jYW52YXMtZnVsbHNjcmVlbiB7XHJcbiAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgICAgdG9wOiAwO1xyXG4gICAgICAgICBib3R0b206IDA7XHJcbiAgICAgICAgIHJpZ2h0OiAwO1xyXG4gICAgICAgICBsZWZ0OiAwO1xyXG4gICAgIH1cclxuICAgICAuc2lnbmF0dXJlLWNvbXBvbmVudC1ib3JkZXIge1xyXG4gICAgICAgICBib3JkZXI6IDJweCBzb2xpZCBibGFjaztcclxuICAgICB9XHJcbiAgICBgXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIE5TaWduYXR1cmVDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgICBpbWFnZURhdGFWYWx1ZSA9ICcnO1xyXG4gICAgcHJpdmF0ZSBzaWduYXR1cmVQYWQ6IGFueSA9ICcnO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3NpZ25hdHVyZWNhbnZhcycsIHtzdGF0aWM6IGZhbHNlfSkgc2lnbmF0dXJlY2FudmFzO1xyXG4gICAgQFZpZXdDaGlsZCgnY2FudmFzcGFyZW50Jywge3N0YXRpYzogZmFsc2V9KSBjYW52YXNwYXJlbnQ7XHJcblxyXG4gICAgQElucHV0KCdiYWNrZ3JvdW5kQ29sb3InKSBiYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICBASW5wdXQoJ2RvdFNpemUnKSBkb3RTaXplOyAvLyAoZmxvYXQgb3IgZnVuY3Rpb24pIFJhZGl1cyBvZiBhIHNpbmdsZSBkb3QuXHJcbiAgICBASW5wdXQoJ21pbldpZHRoJykgbWluV2lkdGg7IC8vIChmbG9hdCkgTWluaW11bSB3aWR0aCBvZiBhIGxpbmUuIERlZmF1bHRzIHRvIDAuNS5cclxuICAgIEBJbnB1dCgnbWF4V2lkdGgnKSBtYXhXaWR0aDsgLy8gKGZsb2F0KSBNYXhpbXVtIHdpZHRoIG9mIGEgbGluZS4gRGVmYXVsdHMgdG8gMi41LlxyXG4gICAgQElucHV0KCd0aHJvdHRsZScpIHRocm90dGxlOyAvLyAoaW50ZWdlcikgRHJhdyB0aGUgbmV4dCBwb2ludCBhdCBtb3N0IG9uY2UgcGVyIGV2ZXJ5IHggbWlsbGlzZWNvbmRzLiBTZXQgaXQgdG8gMCB0byB0dXJuIG9mZiB0aHJvdHRsaW5nLiBEZWZhdWx0cyB0byAxNi5cclxuICAgIEBJbnB1dCgnbWluRGlzdGFuY2UnKSBtaW5EaXN0YW5jZTsgLy8gKGludGVnZXIpIEFkZCB0aGUgbmV4dCBwb2ludCBvbmx5IGlmIHRoZSBwcmV2aW91cyBvbmUgaXMgZmFydGhlciB0aGFuIHggcGl4ZWxzLiBEZWZhdWx0cyB0byA1LiBcclxuICAgIEBJbnB1dCgncGVuQ29sb3InKSBwZW5Db2xvcjsgLy8gKHN0cmluZykgQ29sb3IgdXNlZCB0byBjbGVhciB0aGUgYmFja2dyb3VuZC4gQ2FuIGJlIGFueSBjb2xvciBmb3JtYXQgYWNjZXB0ZWQgYnkgY29udGV4dC5maWxsU3R5bGUuIERlZmF1bHRzIHRvIFwicmdiYSgwLDAsMCwwKVwiICh0cmFuc3BhcmVudCBibGFjaykuIFVzZSBhIG5vbi10cmFuc3BhcmVudCBjb2xvciBlLmcuIFwicmdiKDI1NSwyNTUsMjU1KVwiIChvcGFxdWUgd2hpdGUpIGlmIHlvdSdkIGxpa2UgdG8gc2F2ZSBzaWduYXR1cmVzIGFzIEpQRUcgaW1hZ2VzLlxyXG4gICAgQElucHV0KCd2ZWxvY2l0eUZpbHRlcldlaWdodCcpIHZlbG9jaXR5RmlsdGVyV2VpZ2h0OyAvLyAoZmxvYXQpIFdlaWdodCB1c2VkIHRvIG1vZGlmeSBuZXcgdmVsb2NpdHkgYmFzZWQgb24gdGhlIHByZXZpb3VzIHZlbG9jaXR5LiBEZWZhdWx0cyB0byAwLjcuXHJcbiAgICBASW5wdXQoJ29uQmVnaW4nKSBvbkJlZ2luOyAvLyAoZnVuY3Rpb24pIENhbGxiYWNrIHdoZW4gc3Ryb2tlIGJlZ2luLlxyXG4gICAgQElucHV0KCdvbkVuZCcpIG9uRW5kOyAvLyAoZnVuY3Rpb24pIENhbGxiYWNrIHdoZW4gc3Ryb2tlIGVuZC5cclxuICAgIEBJbnB1dCgnbW9kZScpIG1vZGUgPSAncmVzcG9uc2l2ZSc7IC8vICdjbGljay1mdWxsc2NyZWVuJyBvciAncmVzcG9uc2l2ZSdcclxuICAgIGNhbnZhc01vZGUgPSAncmVzcG9uc2l2ZSc7IC8vICdyZXNwb25zaXZlJyBvciAnZnVsbHNjcmVlbidcclxuICAgIHByaXZhdGUgc2F2ZWREYXRhO1xyXG4gICAgcHJpdmF0ZSBwcmV2aW91c1NhdmVkRGF0YTtcclxuICAgIGNsYXNzQWJzO1xyXG5cclxuICAgIEBPdXRwdXQoKSBpbWFnZURhdGFDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBASW5wdXQoKVxyXG4gICAgZ2V0IGltYWdlRGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbWFnZURhdGFWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaW1hZ2VEYXRhKHZhbCkge1xyXG4gICAgICAgIHRoaXMuaW1hZ2VEYXRhVmFsdWUgPSB2YWw7XHJcbiAgICAgICAgaWYgKHZhbCB8fCB2YWwgPT09ICcnIHx8IHRoaXMuaXNEYXRhVVJMKHZhbCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zYXZlQ2F2YXModmFsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbWFnZURhdGFDaGFuZ2UuZW1pdCh0aGlzLmltYWdlRGF0YVZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3Jlc3BvbnNpdmUnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FudmFzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNhbnZhcygpIHtcclxuICAgICAgICB0aGlzLmZpdFRvQ29udGFpbmVyKHRoaXMuc2lnbmF0dXJlY2FudmFzLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkID0gbmV3IHNpZ25pbmcuZGVmYXVsdCh0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50LCB0aGlzLmFzc2lnbk9wdGlvbnMoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZUNhdmFzKGRhdGFVcmw/KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2lnbmF0dXJlUGFkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNpZ25hdHVyZVBhZC5pc0VtcHR5KCkgfHwgZGF0YVVybCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWREYXRhID0gJyc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5jbGVhcigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNEYXRhVVJMKGRhdGFVcmwpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YVVSTChkYXRhVXJsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZWREYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlRGF0YSA9IHRoaXMuc2lnbmF0dXJlUGFkLnRvRGF0YVVSTCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ2NsaWNrLWZ1bGxzY3JlZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlZERhdGEgPSB0aGlzLnNpZ25hdHVyZVBhZC50b0RhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVDYW52YXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhckNhbnZhcygpIHtcclxuICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5jbGVhcigpO1xyXG4gICAgICAgIC8vIHRoaXMuZml0VG9Db250YWluZXIodGhpcy5zaWduYXR1cmVjYW52YXMubmF0aXZlRWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5kb0NhbnZhcygpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5zaWduYXR1cmVQYWQudG9EYXRhKCk7XHJcblxyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGRhdGEucG9wKCk7IC8vIHJlbW92ZSB0aGUgbGFzdCBkb3Qgb3IgbGluZVxyXG4gICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YShkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0NhbnZhcygpIHtcclxuICAgICAgICB0aGlzLmNsYXNzQWJzID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmNhbnZhc01vZGUgPSAnZnVsbHNjcmVlbic7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNpZ25hdHVyZVBhZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNhbnZhcygpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5maXRUb0NvbnRhaW5lcih0aGlzLnNpZ25hdHVyZWNhbnZhcy5uYXRpdmVFbGVtZW50LCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aClcclxuICAgICAgICB0aGlzLmNsZWFyQ2FudmFzKCk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVDYW52YXNGcm9tRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGVDYW52YXMoKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXNNb2RlID0gJ3Jlc3BvbnNpdmUnO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNhbmNlbCBjdXJyZW50bHkgZHJhd25cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLnNhdmVkRGF0YSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMucHJldmlvdXNTYXZlZERhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNhbnZhc0Zyb21EYXRhKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNhdmVkRGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzU2F2ZWREYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zYXZlZERhdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YSh0aGlzLnNhdmVkRGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZml0VG9Db250YWluZXIoZWxlbWVudCwgaGVpZ2h0Pywgd2lkdGg/KSB7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICdjYWxjKDEwMCUgLSA1NnB4KSc7XHJcbiAgICAgICAgaWYgKGhlaWdodCAmJiB3aWR0aCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gaGVpZ2h0IC0gNTY7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZWxlbWVudC53aWR0aCA9IGVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gZWxlbWVudC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzc2lnbk9wdGlvbnMoKSB7XHJcbiAgICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcclxuICAgICAgICBvcHRpb25zWydiYWNrZ3JvdW5kQ29sb3InXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRSR0IodGhpcy5iYWNrZ3JvdW5kQ29sb3IsICdiYWNrZ3JvdW5kQ29sb3InKVxyXG4gICAgICAgIG9wdGlvbnNbJ2RvdFNpemUnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy5kb3RTaXplLCAnZG90U2l6ZScpO1xyXG4gICAgICAgIG9wdGlvbnNbJ21pbldpZHRoJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWluV2lkdGgsICdtaW5XaWR0aCcpO1xyXG4gICAgICAgIG9wdGlvbnNbJ21heFdpZHRoJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWF4V2lkdGgsICdtYXhXaWR0aCcpO1xyXG4gICAgICAgIG9wdGlvbnNbJ3Rocm90dGxlJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMudGhyb3R0bGUsICd0aHJvdHRsZScpO1xyXG4gICAgICAgIG9wdGlvbnNbJ21pbkRpc3RhbmNlJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWluRGlzdGFuY2UsICdtaW5EaXN0YW5jZScpO1xyXG4gICAgICAgIG9wdGlvbnNbJ3BlbkNvbG9yJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kUkdCKHRoaXMucGVuQ29sb3IsICdwZW5Db2xvcicpXHJcbiAgICAgICAgb3B0aW9uc1sndmVsb2NpdHlGaWx0ZXJXZWlnaHQnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy52ZWxvY2l0eUZpbHRlcldlaWdodCwgJ3ZlbG9jaXR5RmlsdGVyV2VpZ2h0Jyk7XHJcbiAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9ucykpOyAvLyByZW1vdmluZyBhbGwgdW5kZWZpbmVkIGZpZWxkc1xyXG4gICAgICAgIG9wdGlvbnNbJ29uQmVnaW4nXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbih0aGlzLm9uQmVnaW4sICdvbkJlZ2luJyk7XHJcbiAgICAgICAgb3B0aW9uc1snb25FbmQnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbih0aGlzLm9uRW5kLCAnb25FbmQnKTtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKG51bSwgbmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrSWZWYWxpZChudW0pICYmIHRoaXMuY2hlY2tOdW1iZXIobnVtKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVtO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmludmFsaWRUb2FzdChuYW1lLCAnbnVtJyk7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZFZhbHVlQW5kUkdCKGNvbG9yLCBuYW1lKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tJZlZhbGlkKGNvbG9yKSAmJiB0aGlzLmNoZWNrUkdCKGNvbG9yKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW52YWxpZFRvYXN0KG5hbWUsICdyZ2InKTtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkVmFsdWVBbmRGdW5jdGlvbihmbiwgbmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrSWZWYWxpZChmbikgJiYgdGhpcy5jaGVja0lmVmFsaWRGdW5jdGlvbihmbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmludmFsaWRUb2FzdChuYW1lLCAnZnVuY3Rpb24gZm9ybWF0Jyk7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZCh2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrTnVtYmVyKG51bSkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5jaGVja0lzTmFuKE51bWJlcihudW0pKSA/IE51bWJlcihudW0pIDogdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkRnVuY3Rpb24oZm4pIHtcclxuICAgICAgICByZXR1cm4gdHlwZW9mIGZuID09PSAnZnVuY3Rpb24nID8gZm4gOiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1JHQihjb2xvcikge1xyXG4gICAgICAgIGNvbnN0IG1hdGNoQ29sb3JzMSA9IG5ldyBSZWdFeHAoL3JnYlxcKChcXGR7MSwzfSksKFxcZHsxLDN9KSwoXFxkezEsM30pXFwpLyk7XHJcbiAgICAgICAgY29uc3QgbWF0Y2hDb2xvcnMyID0gbmV3IFJlZ0V4cCgvcmdiXFwoKFxcZHsxLDN9KSxbIFxcdF0rKFxcZHsxLDN9KSwoXFxkezEsM30pXFwpLyk7XHJcbiAgICAgICAgY29uc3QgbWF0Y2hDb2xvcnMzID0gbmV3IFJlZ0V4cCgvcmdiXFwoKFxcZHsxLDN9KSwoXFxkezEsM30pLFsgXFx0XSsoXFxkezEsM30pXFwpLylcclxuICAgICAgICByZXR1cm4gbWF0Y2hDb2xvcnMxLnRlc3QoY29sb3IpIHx8IG1hdGNoQ29sb3JzMi50ZXN0KGNvbG9yKSB8fCBtYXRjaENvbG9yczMudGVzdChjb2xvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0lzTmFuKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIE51bWJlci5pc05hTih2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbnZhbGlkVG9hc3Qob3B0aW9uTmFtZSwgb3B0aW9uVHlwZSkge1xyXG4gICAgICAgIHN3aXRjaCAob3B0aW9uVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdudW0nOlxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zbmFja2Jhci5vcGVuKGBJbnZhbGlkICR7b3B0aW9uTmFtZX0gKG51bWJlciBvciBmbG9hdCkgZ2l2ZW4sIHRha2luZyBkZWZhdWx0IHZhbHVlIGluc3RlYWQuYCwgJ09LJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAncmdiJzpcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuc25hY2tiYXIub3BlbihgSW52YWxpZCAke29wdGlvbk5hbWV9IGZvcm1hdCBFZzogcmdiKDI1NSwgMjU1LCAyNTUpICBnaXZlbiwgdGFraW5nIGRlZmF1bHQgdmFsdWUgaW5zdGVhZC5gLCAnT0snKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0RhdGFVUkwocykge1xyXG4gICAgICAgIGlmIChzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gL15cXHMqZGF0YTooW2Etel0rXFwvW2Etel0rKDtbYS16XFwtXStcXD1bYS16XFwtXSspPyk/KDtiYXNlNjQpPyxbYS16MC05XFwhXFwkXFwmXFwnXFwsXFwoXFwpXFwqXFwrXFwsXFw7XFw9XFwtXFwuXFxfXFx+XFw6XFxAXFwvXFw/XFwlXFxzXSpcXHMqJC9pO1xyXG4gICAgICAgICAgICByZXR1cm4gISFzLm1hdGNoKHJlZ2V4KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==